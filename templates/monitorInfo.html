{% extends 'infobase.html' %}

{% block monitor_block %}
    active
{% endblock %}

{% block page-main %}
    <div class="page-header">
        <h1>监测点列表
            <small></small>
        </h1>
    </div>
    <div class="panel panel-primary">
        <!-- Default panel contents -->
        <div class="panel-heading">监测点<i class="fa fa-thumb-tack pull-right"></i></div>
        <div class="panel-body">
            <div class="row" style="margin-bottom: 15px">
                <div class="col-md-12">
                    <div class="input-group">
                        <span class="input-group-btn">
                            <!-- Button trigger modal -->
                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#myModal">
                              搜索
                            </button>
                        </span>
                        <span class="input-group-btn text-right">
                            <!-- Button trigger modal -->
                            <button id="exportBatch" type="button" class="btn btn-primary">
                              批量导出
                            </button>
                        </span>
                    </div><!-- /input-group -->
                </div><!-- /.col-md-4 -->
            </div><!-- /.row -->

            <table class="table table-bordered table-hover table-striped table-condensed">
                <thead>
                <tr>
                    <th>#</th>
                    <th class="hidden">id</th>
                    <th>监测点号</th>
                    <th>物探点号</th>
                    <th>监测方法</th>
                    <th>照片</th>
                    <th>样品</th>
                    <th>流量</th>
                </tr>
                </thead>
                <tbody>
                {% for  monitor in monitors %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td class="hidden">{{ monitor.id }}</td>
                        <td>{{ monitor.name }}</td>
                        <td>{{ monitor.geophysical_point }}</td>
                        <td>
                            {% if monitor.work_function == 0 %}
                                容器法
                            {% elif monitor.work_function == 1 %}
                                流速法(圆管)
                            {% elif monitor.work_function == 2 %}
                                流速法(方渠)
                            {% elif monitor.work_function == 3 %}
                                仪器法
                            {% elif monitor.work_function == 4 %}
                                无法监测
                            {% endif %}
                        </td>
                        <td>
                            <a class="btn btn-primary" href="/photo/?id={{ monitor.id }}"><i
                                    class="fa fa-trash-o">照片</i></a>
                        </td>
                        <td>
                            {% if monitor.work_function == 4 %}
                                <a class="btn btn-danger disabled" href="#"><i
                                        class="fa fa-trash-o">样品</i></a>
                            {% else %}
                                <a class="btn btn-success" href="/sample/?id={{ monitor.id }}"><i
                                        class="fa fa-trash-o">样品</i></a>
                            {% endif %}

                        </td>
                        <td>
                            {% if monitor.work_function == 3 or  monitor.work_function == 4 %}
                                <a class="btn btn-danger disabled" href="#={{ monitor.id }}"><i
                                        class="fa fa-trash-o">流量</i></a>
                            {% else %}
                                <a class="btn btn-info" href="/flow/?id={{ monitor.id }}"><i
                                        class="fa fa-trash-o">流量</i></a>
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5" class="text-center">暂时没有数据哦~</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

            <nav aria-label="Page navigation" class="text-right">
                <ul class="pagination">
                    {% for i in total_page %}
                        {{ i|safe }}
                    {% endfor %}
                </ul>
            </nav>
        </div>
    </div>
{% endblock %}

{% block modal %}
    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">搜索监测点</h4>
                </div>
                <div class="modal-body">
                    <form class="form" method="post" action="">
                        {% csrf_token %}
                        <label for="mFunc">监测方法</label>
                        <select class="form-control" id="mFunc" name="mFunc">
                            <option value="0">容器法</option>
                            <option value="1">流速法（圆管）</option>
                            <option value="2">流速法（方渠）</option>
                            <option value="3">仪器法</option>
                            <option value="4">无法监测</option>
                        </select>
                        <div class="form-group">
                            <label for="mPeople">监测者</label>
                            <input type="text" class="form-control" id="mPeople" placeholder="监测者姓名" name="mPeople">
                            <label for="mDateStart">开始日期</label>
                            <input type="date" class="form-control datepicker datepicker-days dateStart" id="mDateStart"
                                   placeholder="选择查询开始日期" name="mDateStart">
                            <label for="mDateEnd">结束日期</label>
                            <input type="date" class="form-control datepicker datepicker-days dateEnd" id="mDateEnd"
                                   placeholder="选择查询结束日期" name="mDateEnd">
                        </div>
                        <div class="center text-center">
                            <button type="reset" class="btn btn-danger">重置</button>
                            <button type="submit" class="btn btn-primary">确定</button>
                        </div>
                    </form>
                </div>
                {#                <div class="modal-footer">#}
                {#                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>#}
                {#                    <button type="button" class="btn btn-primary">确定</button>#}
                {#                </div>#}
            </div>
        </div>
    </div>

{% endblock %}

{% block page-js %}

    <script type="text/javascript">
      $(document).ready(function() {
        var date = new Date();
        var startMonth = date.getMonth();
        var nowMonth = startMonth + 1;
        var strDate = date.getDate();
        var seperator = '-';
        if (nowMonth >= 1 && nowMonth <= 9) {
          nowMonth = '0' + nowMonth;
        }
        if (startMonth >= 1 && startMonth <= 9) {
          startMonth = '0' + startMonth;
        }
        if (strDate >= 0 && strDate <= 9) {
          strDate = '0' + strDate;
        }

        var startDate = date.getFullYear() + seperator + startMonth + seperator + strDate;
        var nowDate = date.getFullYear() + seperator + nowMonth + seperator + strDate;
        $('.dateStart').val(startDate);
        $('.dateEnd').val(nowDate);

        {#SWEATALEART#}
        $('#exportBatch').on('click', function() {

          swal({
            title: '多输入',
            html:
                '<label for="swalFunc">监测方法</label><select class="form-control" id="swalFunc" name="swalFunc"><option value="0">容器法</option><option value="1">流速法（圆管）</option><option value="2">流速法（方渠）</option><option value="3">仪器法</option><option value="4">无法监测</option></select>' +
                '<label for="swalPeople">监测者</label><input type="text" class="form-control" id="swalPeople" placeholder="监测者姓名" name="swalPeople">' +
                '<label for="mDateStart">开始日期</label><input type="date" class="form-control" id="swalStart" placeholder="选择查询开始日期" name="mDateStart">' +
                '<label for="mDateEnd">结束日期</label><input type="date" class="form-control" id="swalEnd" placeholder="选择查询结束日期" name="mDateEnd">',
            preConfirm: function() {
              return new Promise(function(resolve) {
                resolve([
                  $('#swalFunc').val(),
                  $('#swalPeople').val(),
                  $('#swalStart').val(),
                  $('#swalEnd').val(),
                ]);
              });
            },
            onOpen: function() {
              $('#swalFunc').val(0);
              $('#swalPeople').val('所有人');
              $('#swalStart').val(startDate);
              $('#swalEnd').val(nowDate);
            },
          }).then(function(result) {
            var reqData = JSON.stringify(result);
            $.ajax({
              type: 'POST',
              url: '../export/',
              data:{reqData:reqData},
              header: {'Content-Type': 'application/x-www-form-urlencoded'},
              cache: false,
              success: function(response) {
                swal(
                    'Sccess!',
                    'Your note has been saved!',
                    'success',
                );
              },
              failure: function(response) {
                swal(
                    'Internal Error',
                    'Oops, your note was not saved.', // had a missing comma
                    'error',
                );
              },
            });
          });
        });
      });
    </script>

{% endblock %}